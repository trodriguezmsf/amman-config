<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
    http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

    <changeSet id="Amman_CONFIG_20230809095810132" author="Bindu">
        <comment>Adding Concepts for ClinicalPharmacyAssessment Form</comment>
        <sqlFile path="concepts/ClinicalPharmacyAssessment.sql"/>
    </changeSet>

    <changeSet id="Amman_CONFIG_20230809095813192" author="Bindu">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from concept_answer ca
                join
                concept_name cn
                on ca.concept_id = cn.concept_id
                where ca.answer_concept IN (select concept_id from concept_name where name IN
                ("Treatment plan", "Inappropriate drug regimen", "Drug-drug interaction", "Adverse drug reaction (ADR)", "Contraindications", "Untreated condition", "Therapeutic duplication", "Drug without indication", "Therapeutic drug monitoring", "Alternative recommended medications", "Laboratory investigation required")
                and concept_name_type = "FULLY_SPECIFIED")
                AND
                cn.concept_id IN (select concept_id from concept_name where name = "CPA, Reason for intervention");
            </sqlCheck>
        </preConditions>
        <comment>Adding Answers to CPA, Reason for intervention</comment>
        <sql>
            select concept_id into @concept_id from concept_name where name = "CPA, Reason for intervention" and
            concept_name_type = "FULLY_SPECIFIED" and locale = "en" and voided = 0;
            set @child1_concept_id = 0;
            set @child2_concept_id = 0;
            set @child3_concept_id = 0;
            set @child4_concept_id = 0;
            set @child5_concept_id = 0;
            set @child6_concept_id = 0;
            set @child7_concept_id = 0;
            set @child8_concept_id = 0;
            set @child9_concept_id = 0;
            set @child10_concept_id = 0;
            set @child11_concept_id = 0;
            select concept_id into @child1_concept_id from concept_name where name ="Treatment plan" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            select concept_id into @child2_concept_id from concept_name where name ="Inappropriate drug regimen" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            select concept_id into @child3_concept_id from concept_name where name ="Drug-drug interaction" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            select concept_id into @child4_concept_id from concept_name where name ="Adverse drug reaction (ADR)" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            select concept_id into @child5_concept_id from concept_name where name ="Contraindications" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            select concept_id into @child6_concept_id from concept_name where name ="Untreated condition" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            select concept_id into @child7_concept_id from concept_name where name ="Therapeutic duplication" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            select concept_id into @child8_concept_id from concept_name where name ="Drug without indication" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            select concept_id into @child9_concept_id from concept_name where name ="Therapeutic drug monitoring" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            select concept_id into @child10_concept_id from concept_name where name ="Alternative recommended medications" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            select concept_id into @child11_concept_id from concept_name where name ="Laboratory investigation required" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            call add_concept_answer(@concept_id, @child1_concept_id, 1);
            call add_concept_answer(@concept_id, @child2_concept_id, 2);
            call add_concept_answer(@concept_id, @child3_concept_id, 3);
            call add_concept_answer(@concept_id, @child4_concept_id, 4);
            call add_concept_answer(@concept_id, @child5_concept_id, 5);
            call add_concept_answer(@concept_id, @child6_concept_id, 6);
            call add_concept_answer(@concept_id, @child7_concept_id, 7);
            call add_concept_answer(@concept_id, @child8_concept_id, 8);
            call add_concept_answer(@concept_id, @child9_concept_id, 9);
            call add_concept_answer(@concept_id, @child10_concept_id, 10);
            call add_concept_answer(@concept_id, @child11_concept_id, 11);
        </sql>
    </changeSet>

    <changeSet id="Amman_CONFIG_20230809095813664" author="Bindu">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from concept_answer ca
                join
                concept_name cn
                on ca.concept_id = cn.concept_id
                where ca.answer_concept IN (select concept_id from concept_name where name IN
                ("Step up", "Step down")
                and concept_name_type = "FULLY_SPECIFIED")
                AND
                cn.concept_id IN (select concept_id from concept_name where name = "CPA, Change in treatment plan");
            </sqlCheck>
        </preConditions>
        <comment>Adding Answers to CPA, Change in treatment plan</comment>
        <sql>
            select concept_id into @concept_id from concept_name where name = "CPA, Change in treatment plan" and
            concept_name_type = "FULLY_SPECIFIED" and locale = "en" and voided = 0;
            set @child1_concept_id = 0;
            set @child2_concept_id = 0;
            select concept_id into @child1_concept_id from concept_name where name ="Step up" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            select concept_id into @child2_concept_id from concept_name where name ="Step down" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            call add_concept_answer(@concept_id, @child1_concept_id, 1);
            call add_concept_answer(@concept_id, @child2_concept_id, 2);
        </sql>
    </changeSet>

    <changeSet id="Amman_CONFIG_20230809095814749" author="Bindu">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from concept_answer ca
                join
                concept_name cn
                on ca.concept_id = cn.concept_id
                where ca.answer_concept IN (select concept_id from concept_name where name IN
                ("Contraindicated combination", "Combination to be avoided", "Use with caution", "To be taken into account")
                and concept_name_type = "FULLY_SPECIFIED")
                AND
                cn.concept_id IN (select concept_id from concept_name where name = "CPA, Type of drug-drug interaction");
            </sqlCheck>
        </preConditions>
        <comment>Adding Answers to CPA, Type of drug-drug interaction</comment>
        <sql>
            select concept_id into @concept_id from concept_name where name = "CPA, Type of drug-drug interaction" and
            concept_name_type = "FULLY_SPECIFIED" and locale = "en" and voided = 0;
            set @child1_concept_id = 0;
            set @child2_concept_id = 0;
            set @child3_concept_id = 0;
            set @child4_concept_id = 0;
            select concept_id into @child1_concept_id from concept_name where name ="Contraindicated combination" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            select concept_id into @child2_concept_id from concept_name where name ="Combination to be avoided" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            select concept_id into @child3_concept_id from concept_name where name ="Use with caution" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            select concept_id into @child4_concept_id from concept_name where name ="To be taken into account" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            call add_concept_answer(@concept_id, @child1_concept_id, 1);
            call add_concept_answer(@concept_id, @child2_concept_id, 2);
            call add_concept_answer(@concept_id, @child3_concept_id, 3);
            call add_concept_answer(@concept_id, @child4_concept_id, 4);
        </sql>
    </changeSet>

    <changeSet id="Amman_CONFIG_20230809095816364" author="Bindu">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from concept_answer ca
                join
                concept_name cn
                on ca.concept_id = cn.concept_id
                where ca.answer_concept IN (select concept_id from concept_name where name IN
                ("Nausea and vomiting", "Neutropenia", "Thrombocytopenia", "Acute kidney injury", "Sensitivity reaction", "Diarrhoea", "Hypoglycaemia", "Other")
                and concept_name_type = "FULLY_SPECIFIED")
                AND
                cn.concept_id IN (select concept_id from concept_name where name = "CPA, Type of adverse drug reaction (ADR)");
            </sqlCheck>
        </preConditions>
        <comment>Adding Answers to CPA, Type of adverse drug reaction (ADR)</comment>
        <sql>
            select concept_id into @concept_id from concept_name where name = "CPA, Type of adverse drug reaction (ADR)" and
            concept_name_type = "FULLY_SPECIFIED" and locale = "en" and voided = 0;
            set @child1_concept_id = 0;
            set @child2_concept_id = 0;
            set @child3_concept_id = 0;
            set @child4_concept_id = 0;
            set @child5_concept_id = 0;
            set @child6_concept_id = 0;
            set @child7_concept_id = 0;
            set @child8_concept_id = 0;
            select concept_id into @child1_concept_id from concept_name where name ="Nausea and vomiting" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            select concept_id into @child2_concept_id from concept_name where name ="Neutropenia" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            select concept_id into @child3_concept_id from concept_name where name ="Thrombocytopenia" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            select concept_id into @child4_concept_id from concept_name where name ="Acute kidney injury" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            select concept_id into @child5_concept_id from concept_name where name ="Sensitivity reaction" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            select concept_id into @child6_concept_id from concept_name where name ="Diarrhoea" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            select concept_id into @child7_concept_id from concept_name where name ="Hypoglycaemia" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            select concept_id into @child8_concept_id from concept_name where name ="Other" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            call add_concept_answer(@concept_id, @child1_concept_id, 1);
            call add_concept_answer(@concept_id, @child2_concept_id, 2);
            call add_concept_answer(@concept_id, @child3_concept_id, 3);
            call add_concept_answer(@concept_id, @child4_concept_id, 4);
            call add_concept_answer(@concept_id, @child5_concept_id, 5);
            call add_concept_answer(@concept_id, @child6_concept_id, 6);
            call add_concept_answer(@concept_id, @child7_concept_id, 7);
            call add_concept_answer(@concept_id, @child8_concept_id, 8);
        </sql>
    </changeSet>

    <changeSet id="Amman_CONFIG_20230809095819207" author="Bindu">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from concept_answer ca
                join
                concept_name cn
                on ca.concept_id = cn.concept_id
                where ca.answer_concept IN (select concept_id from concept_name where name IN
                ("Vancomycin", "Amikacin", "Gentamicin", "Phenytoin", "Electrolyte (Ca, Mg, K)", "Carbamazepine", "Aminophylline", "Digoxin", "Antifungal triazoles", "Phenobarbital", "Valproic acid", "Other")
                and concept_name_type = "FULLY_SPECIFIED")
                AND
                cn.concept_id IN (select concept_id from concept_name where name = "CPA, Therapeutic drug monitoring for");
            </sqlCheck>
        </preConditions>
        <comment>Adding Answers to CPA, Therapeutic drug monitoring for</comment>
        <sql>
            select concept_id into @concept_id from concept_name where name = "CPA, Therapeutic drug monitoring for" and
            concept_name_type = "FULLY_SPECIFIED" and locale = "en" and voided = 0;
            set @child1_concept_id = 0;
            set @child2_concept_id = 0;
            set @child3_concept_id = 0;
            set @child4_concept_id = 0;
            set @child5_concept_id = 0;
            set @child6_concept_id = 0;
            set @child7_concept_id = 0;
            set @child8_concept_id = 0;
            set @child9_concept_id = 0;
            set @child10_concept_id = 0;
            set @child11_concept_id = 0;
            set @child12_concept_id = 0;
            select concept_id into @child1_concept_id from concept_name where name ="Vancomycin" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            select concept_id into @child2_concept_id from concept_name where name ="Amikacin" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            select concept_id into @child3_concept_id from concept_name where name ="Gentamicin" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            select concept_id into @child4_concept_id from concept_name where name ="Phenytoin" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            select concept_id into @child5_concept_id from concept_name where name ="Electrolyte (Ca, Mg, K)" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            select concept_id into @child6_concept_id from concept_name where name ="Carbamazepine" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            select concept_id into @child7_concept_id from concept_name where name ="Aminophylline" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            select concept_id into @child8_concept_id from concept_name where name ="Digoxin" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            select concept_id into @child9_concept_id from concept_name where name ="Antifungal triazoles" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            select concept_id into @child10_concept_id from concept_name where name ="Phenobarbital" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            select concept_id into @child11_concept_id from concept_name where name ="Valproic acid" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            select concept_id into @child12_concept_id from concept_name where name ="Other" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            call add_concept_answer(@concept_id, @child1_concept_id, 1);
            call add_concept_answer(@concept_id, @child2_concept_id, 2);
            call add_concept_answer(@concept_id, @child3_concept_id, 3);
            call add_concept_answer(@concept_id, @child4_concept_id, 4);
            call add_concept_answer(@concept_id, @child5_concept_id, 5);
            call add_concept_answer(@concept_id, @child6_concept_id, 6);
            call add_concept_answer(@concept_id, @child7_concept_id, 7);
            call add_concept_answer(@concept_id, @child8_concept_id, 8);
            call add_concept_answer(@concept_id, @child9_concept_id, 9);
            call add_concept_answer(@concept_id, @child10_concept_id, 10);
            call add_concept_answer(@concept_id, @child11_concept_id, 11);
            call add_concept_answer(@concept_id, @child12_concept_id, 12);
        </sql>
    </changeSet>

    <changeSet id="Amman_CONFIG_20230809095819691" author="Bindu">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from concept_answer ca
                join
                concept_name cn
                on ca.concept_id = cn.concept_id
                where ca.answer_concept IN (select concept_id from concept_name where name IN
                ("Yes", "No")
                and concept_name_type = "FULLY_SPECIFIED")
                AND
                cn.concept_id IN (select concept_id from concept_name where name = "CPA, Intervention accepted by the prescriber?");
            </sqlCheck>
        </preConditions>
        <comment>Adding Answers to CPA, Intervention accepted by the prescriber?</comment>
        <sql>
            select concept_id into @concept_id from concept_name where name = "CPA, Intervention accepted by the prescriber?" and
            concept_name_type = "FULLY_SPECIFIED" and locale = "en" and voided = 0;
            set @child1_concept_id = 0;
            set @child2_concept_id = 0;
            select concept_id into @child1_concept_id from concept_name where name ="Yes" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            select concept_id into @child2_concept_id from concept_name where name ="No" and concept_name_type ="FULLY_SPECIFIED" and locale ="en" and voided = 0;
            call add_concept_answer(@concept_id, @child1_concept_id, 1);
            call add_concept_answer(@concept_id, @child2_concept_id, 2);
        </sql>
    </changeSet>

    <changeSet id="AMMAN_CONFIG_202308101613510" author="Bindu">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from concept_answer ca
                join
                concept_name cn
                on ca.concept_id = cn.concept_id
                where ca.answer_concept IN (select concept_id from concept_name where name IN
                ("CPA, Date recorded", "CPA, Patient related medical information", "CPA, Clinical pharmacy interventions")
                and concept_name_type = "FULLY_SPECIFIED")
                AND
                cn.concept_id IN (select concept_id from concept_name where name = "CPA, Clinical Pharmacy Assessment");
            </sqlCheck>
        </preConditions>
        <comment>Adding Set Members to Clinical Pharmacy Assessment</comment>
        <sql>
            select concept_id into @concept_id from concept_name where name = "CPA, Clinical Pharmacy Assessment" and
            concept_name_type = 'FULLY_SPECIFIED' and locale = "en" and voided = 0;
            set @member1_concept_id = 0;
            set @member2_concept_id = 0;
            set @member3_concept_id = 0;

            select concept_id into @member1_concept_id from concept_name where name ="CPA, Date recorded" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @member2_concept_id from concept_name where name ="CPA, Patient related medical information" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @member3_concept_id from concept_name where name ="CPA, Clinical pharmacy interventions" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            
            call add_concept_set_members(@concept_id, @member1_concept_id, 1);
            call add_concept_set_members(@concept_id, @member2_concept_id, 2);
            call add_concept_set_members(@concept_id, @member3_concept_id, 3);
        </sql>
    </changeSet>

    <changeSet id="AMMAN_CONFIG_202308101614330" author="Bindu">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from concept_answer ca
                join
                concept_name cn
                on ca.concept_id = cn.concept_id
                where ca.answer_concept IN (select concept_id from concept_name where name IN
                ("CPA, Weight","CPA, Height","CPA, BMI","CPA, Allergy","CPA, Pre-existing disease","CPA, Pre-existing medication",
                "CPA, Ideal body weight (IBW)","CPA, Adjusted body weight (ABW)","CPA, Creatinine clearance")
                and concept_name_type = "FULLY_SPECIFIED")
                AND
                cn.concept_id IN (select concept_id from concept_name where name = "CPA, Patient related medical information");
            </sqlCheck>
        </preConditions>
        <comment>Adding Set Members to Patient related medical information</comment>
        <sql>
            select concept_id into @concept_id from concept_name where name = "CPA, Patient related medical information" and
            concept_name_type = 'FULLY_SPECIFIED' and locale = "en" and voided = 0;
            set @member1_concept_id = 0;
            set @member2_concept_id = 0;
            set @member3_concept_id = 0;
            set @member4_concept_id = 0;
            set @member5_concept_id = 0;
            set @member6_concept_id = 0;
            set @member7_concept_id = 0;
            set @member8_concept_id = 0;
            set @member9_concept_id = 0;

            select concept_id into @member1_concept_id from concept_name where name ="CPA, Weight" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @member2_concept_id from concept_name where name ="CPA, Height" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @member3_concept_id from concept_name where name ="CPA, BMI" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @member4_concept_id from concept_name where name ="CPA, Allergy" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @member5_concept_id from concept_name where name ="CPA, Pre-existing disease" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @member6_concept_id from concept_name where name ="CPA, Pre-existing medication" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @member7_concept_id from concept_name where name ="CPA, Ideal body weight (IBW)" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @member8_concept_id from concept_name where name ="CPA, Adjusted body weight (ABW)" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @member9_concept_id from concept_name where name ="CPA, Creatinine clearance" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
           
            call add_concept_set_members(@concept_id, @member1_concept_id, 1);
            call add_concept_set_members(@concept_id, @member2_concept_id, 2);
            call add_concept_set_members(@concept_id, @member3_concept_id, 3);
            call add_concept_set_members(@concept_id, @member4_concept_id, 4);
            call add_concept_set_members(@concept_id, @member5_concept_id, 5);
            call add_concept_set_members(@concept_id, @member6_concept_id, 6);
            call add_concept_set_members(@concept_id, @member7_concept_id, 7);
            call add_concept_set_members(@concept_id, @member8_concept_id, 8);
            call add_concept_set_members(@concept_id, @member9_concept_id, 9);
        </sql>
    </changeSet>

    <changeSet id="AMMAN_CONFIG_202308101613500" author="Bindu">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from concept_answer ca
                join
                concept_name cn
                on ca.concept_id = cn.concept_id
                where ca.answer_concept IN (select concept_id from concept_name where name IN
                ("CPA, Targeted medication name and details","CPA, Reason for intervention","CPA, Change in treatment plan",
                "CPA, Comments on change in treatment plan","CPA, Comments on inappropriate drug regimen (dose modification)","CPA, Type of drug-drug interaction",
                "CPA, Comments on drug-drug interaction","CPA, Type of adverse drug reaction (ADR)","CPA, Comments on adverse drug reaction","CPA, Comments on contraindications",
                "CPA, Comments on untreated condition","CPA, Comments on therapeutic duplication","CPA, Comments on drug without indication","CPA, Therapeutic drug monitoring for",
                "CPA, Comments on therapeutic drug monitoring","CPA, Comments on alternative recommended medications","CPA, Comments on laboratory investigation required",
                "CPA, Intervention accepted by the prescriber?","CPA, Comments on the accepted intervention","CPA, Why intervention not accepted by the prescriber?")
                and concept_name_type = "FULLY_SPECIFIED")
                AND
                cn.concept_id IN (select concept_id from concept_name where name = "CPA, Clinical pharmacy interventions");
            </sqlCheck>
        </preConditions>
        <comment>Adding Set Members to Clinical Pharmacy Interventions</comment>
        <sql>
            select concept_id into @concept_id from concept_name where name = "CPA, Clinical pharmacy interventions" and
            concept_name_type = 'FULLY_SPECIFIED' and locale = "en" and voided = 0;
            set @member1_concept_id = 0;
            set @member2_concept_id = 0;
            set @member3_concept_id = 0;                
            set @member4_concept_id = 0;                
            set @member5_concept_id = 0;                
            set @member6_concept_id = 0;                
            set @member7_concept_id = 0;                
            set @member8_concept_id = 0;                
            set @member9_concept_id = 0;                
            set @member10_concept_id = 0;                
            set @member11_concept_id = 0;                
            set @member12_concept_id = 0;                
            set @member13_concept_id = 0;                
            set @member14_concept_id = 0;                
            set @member15_concept_id = 0;                
            set @member16_concept_id = 0;                
            set @member17_concept_id = 0;                
            set @member18_concept_id = 0;                
            set @member19_concept_id = 0;                
            set @member20_concept_id = 0;                

            select concept_id into @member1_concept_id from concept_name where name ="CPA, Targeted medication name and details" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @member2_concept_id from concept_name where name ="CPA, Reason for intervention" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @member3_concept_id from concept_name where name ="CPA, Change in treatment plan" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @member4_concept_id from concept_name where name ="CPA, Comments on change in treatment plan" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @member5_concept_id from concept_name where name ="CPA, Comments on inappropriate drug regimen (dose modification)" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @member6_concept_id from concept_name where name ="CPA, Type of drug-drug interaction" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @member7_concept_id from concept_name where name ="CPA, Comments on drug-drug interaction" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @member8_concept_id from concept_name where name ="CPA, Type of adverse drug reaction (ADR)" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @member9_concept_id from concept_name where name ="CPA, Comments on adverse drug reaction" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @member10_concept_id from concept_name where name ="CPA, Comments on contraindications" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @member11_concept_id from concept_name where name ="CPA, Comments on untreated condition" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @member12_concept_id from concept_name where name ="CPA, Comments on therapeutic duplication" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @member13_concept_id from concept_name where name ="CPA, Comments on drug without indication" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @member14_concept_id from concept_name where name ="CPA, Therapeutic drug monitoring for" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @member15_concept_id from concept_name where name ="CPA, Comments on therapeutic drug monitoring" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @member16_concept_id from concept_name where name ="CPA, Comments on alternative recommended medications" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @member17_concept_id from concept_name where name ="CPA, Comments on laboratory investigation required" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @member18_concept_id from concept_name where name ="CPA, Intervention accepted by the prescriber?" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @member19_concept_id from concept_name where name ="CPA, Comments on the accepted intervention" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @member20_concept_id from concept_name where name ="CPA, Why intervention not accepted by the prescriber?" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            
            call add_concept_set_members(@concept_id, @member1_concept_id, 1);
            call add_concept_set_members(@concept_id, @member2_concept_id, 2);
            call add_concept_set_members(@concept_id, @member3_concept_id, 3);
            call add_concept_set_members(@concept_id, @member4_concept_id, 4);
            call add_concept_set_members(@concept_id, @member5_concept_id, 5);
            call add_concept_set_members(@concept_id, @member6_concept_id, 6);
            call add_concept_set_members(@concept_id, @member7_concept_id, 7);
            call add_concept_set_members(@concept_id, @member8_concept_id, 8);
            call add_concept_set_members(@concept_id, @member9_concept_id, 9);
            call add_concept_set_members(@concept_id, @member10_concept_id, 10);
            call add_concept_set_members(@concept_id, @member11_concept_id, 11);
            call add_concept_set_members(@concept_id, @member12_concept_id, 12);
            call add_concept_set_members(@concept_id, @member13_concept_id, 13);
            call add_concept_set_members(@concept_id, @member14_concept_id, 14);
            call add_concept_set_members(@concept_id, @member15_concept_id, 15);
            call add_concept_set_members(@concept_id, @member16_concept_id, 16);
            call add_concept_set_members(@concept_id, @member17_concept_id, 17);
            call add_concept_set_members(@concept_id, @member18_concept_id, 18);
            call add_concept_set_members(@concept_id, @member19_concept_id, 19);
            call add_concept_set_members(@concept_id, @member20_concept_id, 20);
        </sql>
    </changeSet>

    <changeSet id="AMMAN_CONFIG_202308111413510" author="Bindu">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from concept_answer ca
                join
                concept_name cn
                on ca.concept_id = cn.concept_id
                where ca.answer_concept IN (select concept_id from concept_name where name IN
                ("BMI")
                and concept_name_type = "FULLY_SPECIFIED")
                AND
                cn.concept_id IN (select concept_id from concept_name where name = "CPA, BMI");
            </sqlCheck>
        </preConditions>
        <comment>Adding Set Members to BMI</comment>
        <sql>
            select concept_id into @concept_id from concept_name where name = "CPA, BMI" and
            concept_name_type = 'FULLY_SPECIFIED' and locale = "en" and voided = 0;
            set @member1_concept_id = 0;

            select concept_id into @member1_concept_id from concept_name where name ="BMI Computed" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            
            call add_concept_set_members(@concept_id, @member1_concept_id, 1);
        </sql>
    </changeSet>

    <changeSet id="AMMAN_CONFIG_202308140913510" author="Bindu">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from concept_answer ca
                join
                concept_name cn
                on ca.concept_id = cn.concept_id
                where ca.answer_concept IN (select concept_id from concept_name where name IN
                ("ABW Computed")
                and concept_name_type = "FULLY_SPECIFIED")
                AND
                cn.concept_id IN (select concept_id from concept_name where name = "CPA, Adjusted body weight (ABW)");
            </sqlCheck>
        </preConditions>
        <comment>Adding Set Members to BMI</comment>
        <sql>
            select concept_id into @concept_id from concept_name where name = "CPA, Adjusted body weight (ABW)" and
            concept_name_type = 'FULLY_SPECIFIED' and locale = "en" and voided = 0;
            set @member1_concept_id = 0;

            select concept_id into @member1_concept_id from concept_name where name ="ABW Computed" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            
            call add_concept_set_members(@concept_id, @member1_concept_id, 1);
        </sql>
    </changeSet>

    <changeSet id="Amman_CONFIG_202308141220460" author="Bindu, Keerthi">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from concept_reference_term
                where code in
                ("121689","141747","133473","5622","86082","71060","82023","72822",
                "71101","74860","81951","86052","5090","5089","1342","100")
                and retired = 0
                and concept_source_id = (
                select concept_source_id from concept_reference_source where name = "CEIL"  and retired =0
                );
            </sqlCheck>
        </preConditions>
        <comment>Adding CEIL codes to concepts</comment>
        <sql>
            SELECT concept_source_id INTO @source_id FROM concept_reference_source where name = "CEIL";

            INSERT INTO concept_reference_term (creator,code,concept_source_id,uuid,date_created) VALUES (1,"121689",@source_id,uuid(),now());
            INSERT INTO concept_reference_term (creator,code,concept_source_id,uuid,date_created) VALUES (1,"141747",@source_id,uuid(),now());
            INSERT INTO concept_reference_term (creator,code,concept_source_id,uuid,date_created) VALUES (1,"133473",@source_id,uuid(),now());
            INSERT INTO concept_reference_term (creator,code,concept_source_id,uuid,date_created) VALUES (1,"5622",@source_id,uuid(),now());
            INSERT INTO concept_reference_term (creator,code,concept_source_id,uuid,date_created) VALUES (1,"86082",@source_id,uuid(),now());
            INSERT INTO concept_reference_term (creator,code,concept_source_id,uuid,date_created) VALUES (1,"71060",@source_id,uuid(),now());
            INSERT INTO concept_reference_term (creator,code,concept_source_id,uuid,date_created) VALUES (1,"82023",@source_id,uuid(),now());
            INSERT INTO concept_reference_term (creator,code,concept_source_id,uuid,date_created) VALUES (1,"72822",@source_id,uuid(),now());
            INSERT INTO concept_reference_term (creator,code,concept_source_id,uuid,date_created) VALUES (1,"71101",@source_id,uuid(),now());
            INSERT INTO concept_reference_term (creator,code,concept_source_id,uuid,date_created) VALUES (1,"74860",@source_id,uuid(),now());
            INSERT INTO concept_reference_term (creator,code,concept_source_id,uuid,date_created) VALUES (1,"81951",@source_id,uuid(),now());
            INSERT INTO concept_reference_term (creator,code,concept_source_id,uuid,date_created) VALUES (1,"86052",@source_id,uuid(),now());
            INSERT INTO concept_reference_term (creator,code,concept_source_id,uuid,date_created) VALUES (1,"5090",@source_id,uuid(),now());
            INSERT INTO concept_reference_term (creator,code,concept_source_id,uuid,date_created) VALUES (1,"5089",@source_id,uuid(),now());
            INSERT INTO concept_reference_term (creator,code,concept_source_id,uuid,date_created) VALUES (1,"1342",@source_id,uuid(),now());
            INSERT INTO concept_reference_term (creator,code,concept_source_id,uuid,date_created) VALUES (1,"100",@source_id,uuid(),now());
            
            call CREATE_REFERENCE_MAPPING_CEIL("CPA, Height","5090");
            call CREATE_REFERENCE_MAPPING_CEIL("CPA, Weight","5089");
            call CREATE_REFERENCE_MAPPING_CEIL("CPA, BMI","1342");
            call CREATE_REFERENCE_MAPPING_CEIL("CPA, Allergy","121689");
            call CREATE_REFERENCE_MAPPING_CEIL("Drug-drug interaction","141747");
            call CREATE_REFERENCE_MAPPING_CEIL("Nausea and vomiting","133473");
            call CREATE_REFERENCE_MAPPING_CEIL("Diarrhoea","142412");
            call CREATE_REFERENCE_MAPPING_CEIL("Other","5622");
            call CREATE_REFERENCE_MAPPING_CEIL("Vancomycin","86082");
            call CREATE_REFERENCE_MAPPING_CEIL("Amikacin","71060");
            call CREATE_REFERENCE_MAPPING_CEIL("Gentamicin","100");
            call CREATE_REFERENCE_MAPPING_CEIL("Phenytoin","82023");
            call CREATE_REFERENCE_MAPPING_CEIL("Carbamazepine","72822");
            call CREATE_REFERENCE_MAPPING_CEIL("Aminophylline","71101");
            call CREATE_REFERENCE_MAPPING_CEIL("Digoxin","74860");
            call CREATE_REFERENCE_MAPPING_CEIL("Phenobarbital","81951");
            call CREATE_REFERENCE_MAPPING_CEIL("Valproic acid","86052");
            call CREATE_REFERENCE_MAPPING_CEIL("CPA, Date recorded","162869");
        </sql>
    </changeSet>

    <changeSet id="AMMAN_CONFIG_20230810160135523" author="Bindu">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select COUNT(*) from concept_set cs
                                         join concept_name cn
                                              on cs.concept_id = cn.concept_id
                where cs.concept_id IN (select concept_id from concept_name where name ="CPA, Clinical Pharmacy Assessment"  AND concept_name_type = "FULLY_SPECIFIED")
                  and cs.concept_set IN (select concept_id from concept_name where name = "All Observation Templates");
            </sqlCheck>
        </preConditions>
        <comment>Adding set members to all observation templates</comment>
        <sql>
            set @concept_id = 0;
            set @member1_concept_id = 0;

            select concept_id into @concept_id from concept_name where name = "All Observation Templates" and concept_name_type = "FULLY_SPECIFIED" and locale = "en" and voided = 0;
            select concept_id into @member1_concept_id from concept_name where name = "CPA, Clinical Pharmacy Assessment" and concept_name_type = "FULLY_SPECIFIED" and locale = "en" and voided = 0;

            call add_concept_set_members (@concept_id, @member1_concept_id, 1);
        </sql>
    </changeSet>
</databaseChangeLog>
